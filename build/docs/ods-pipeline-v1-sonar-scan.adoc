Scan source code with SonarQube

Default SonarQube project properties are provided unless `sonar-project.properties`
is present.

When `quality-gate` is set to `true`, the task will fail if the quality gate
is not passed.

The SonarQube scan will include parameters to perform a pull request analysis if
there is an open pull request for the branch being built. If the
link:https://docs.sonarqube.org/latest/analysis/bitbucket-integration/[ALM integration]
is setup properly, pull request decoration in Bitbucket is done automatically.

The following artifacts are generated by the build task and placed into `.ods/artifacts/`

* `sonarqube-analysis/`
  ** `analysis-report.md`
  ** `issues-report.csv`
  ** `quality-gate.json`

== Installation

Before this task can be used, a `ConfigMap` named `ods-sonar` and a `Secret` named `ods-sonar-auth` have to be set up. Those resources are used by the task to find the SonarQube instance against which the scan should happen. See the following for an example:

```
kind: ConfigMap
apiVersion: v1
metadata:
  name: ods-sonar
data:
  url: 'https://sonarqube.example.com'
  edition: 'community'
```

```
kind: Secret
apiVersion: v1
metadata:
  name: 'ods-sonar-auth'
type: kubernetes.io/basic-auth
stringData:
  password: 'pwd'
  username: 'user'
```

These may also be created via `kubectl`:
```
kubectl create configmap ods-sonar --from-literal=url=https://sonarqube.example.com --from-literal=edition=community
kubectl create secret generic ods-sonar-auth --type=kubernetes.io/basic-auth --from-literal=password=pwd --from-literal=username=user
```

== Usage

Either install the task via `kubectl apply -f <task>.yaml` or reference it through remote resolution:

```
name: scan
taskRef:
  resolver: git
  params:
  - {name: url, value: https://github.com/bix-digital/ods-pipeline-sonar.git}
  - {name: revision, value: main}
  - {name: pathInRepo, value: tasks/ods-pipeline-v1-sonar-scan.yaml}
  workspaces:
  - {name: source, workspace: shared-workspace }
```
